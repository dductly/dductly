name: Continuous Integration

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: "0 10 * * 1"  # Weekly (Mondays at 4:00 AM MDT)

permissions:
  contents: read
  pull-requests: write

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Run Super-Linter
        uses: super-linter/super-linter@v8.4.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEFAULT_BRANCH: main
          VALIDATE_ALL_CODEBASE: ${{ github.event_name == 'schedule' }}
          IGNORE_GITIGNORED_FILES: true
          ENABLE_GIT_PULL_REQUEST_SUMMARY_COMMENT: true
          VALIDATE_TYPESCRIPT_ES: true
          VALIDATE_JAVASCRIPT_ES: true
          VALIDATE_JSON: true
          VALIDATE_CSS: true
          VALIDATE_HTML: true
          VALIDATE_SQL: true

      - name: Run Unit Tests
        run: npm test
        env:
          CI: true  # ensures headless mode for Vitest/Jest

  # build:
  #   runs-on: ubuntu-latest
  #   needs: lint-and-test
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v5

  #     - name: Set up Node.js
  #       uses: actions/setup-node@v3
  #       with:
  #         node-version: 20
  #         cache: "npm"

  #     - name: Install production dependencies only
  #       run: npm ci --omit=dev  # skips test libraries

  #     - name: Build Frontend
  #       run: npm run build
